# py-shiny Project Configuration

## Project Overview
py-shiny is the Python implementation of Shiny, a framework for building fast, beautiful web applications. This project maintains feature parity with Shiny for R, often porting components from the R bslib package.

## Repository Structure

### Core Directories
- `shiny/` - Main Python package source code
  - `shiny/ui/` - UI component implementations
  - `shiny/express/` - Express mode API
  - `shiny/playwright/controller/` - Playwright test controllers
  - `shiny/www/shared/` - Vendored assets (SCSS, CSS, JS)
- `tests/` - Unit tests (pytest)
  - `tests/playwright/` - End-to-end Playwright tests
- `docs/` - Documentation source
  - `docs/_quartodoc-*.yml` - API reference configuration
- `shiny/api-examples/` - Example applications for documentation
- `examples/` - Example applications
- `js/` - JavaScript/TypeScript source
- `scripts/` - Build and maintenance scripts
- `.claude/skills/` - Claude Code skills for this project

### Key Files
- `pyproject.toml` - Python package configuration
- `Makefile` - Development commands and workflows
- `CHANGELOG.md` - Release notes and changes
- `scripts/_pkg-sources.R` - Upstream package sources for vendoring

## Development Workflow

### Common Commands
```bash
# Install development dependencies
pip install -e ".[dev,test,doc]"

# Apply formatting and linting
make format

# Run type checking
make check-types

# Run unit tests
make check-tests

# Run Playwright end-to-end tests
make playwright

# Build documentation (slow, run at the end)
make docs

# Comprehensive checks (slower)
make check

# Vendor assets from bslib/shiny/sass/htmltools
make upgrade-html-deps
```

### Testing Conventions
- Unit tests use pytest
- End-to-end tests use Playwright with custom controllers
- Playwright controllers are in `shiny/playwright/controller/`
- Test apps are in `tests/playwright/shiny/`

## Porting Components from bslib

When porting components from R's bslib package:
1. Review the `.claude/skills/port-from-bslib/SKILL.md` for comprehensive guidance
2. Understand the source (R, TypeScript, SCSS)
3. Create Python implementation in `shiny/ui/`
4. Run `make upgrade-html-deps` to vendor compiled assets
5. Create API examples in `shiny/api-examples/`
6. Add Playwright controller (if input component)
7. Port unit tests and create end-to-end tests
8. Update quartodoc YAML files
9. Update CHANGELOG.md

## Code Patterns

### Parameter Naming
- Use `snake_case` for all parameter names
- Use `Optional[T]` for parameters that can be `None`
- Use `Literal` for parameters with specific allowed values

### Component Dependencies
- Use `components_dependencies()` for bslib component dependencies
- Assets are automatically bundled from vendored files

### HTML Generation
- Use `htmltools` Tag objects
- Prefer `.add_class()`, `.add_style()`, `.attrs` for modifications
- Use `ui.tags` for creating new elements

### Type Safety
- Always include type hints on function signatures
- Run `make check-types` to verify with pyright

## Documentation

### API Reference
- Add functions to `docs/_quartodoc-core.yml`
- Add express functions to `docs/_quartodoc-express.yml`
- Add Playwright controllers to `docs/_quartodoc-testing.yml`
- Keep entries in alphabetical order within sections

### Examples
- Create both core and express mode examples when applicable
- Place in `shiny/api-examples/[component_name]/`
- Keep examples simple and focused

## Pre-commit Hooks
The project uses pre-commit hooks for:
- Code formatting (black, isort)
- Linting (flake8, pyright)
- Install with: `pre-commit install`

## Branching Strategy
- Main development branch: `main`
- Feature branches: Use descriptive names
- PRs should link to related bslib PRs when porting

## Asset Management
Vendored assets (SCSS, CSS, JavaScript) are stored in `shiny/www/shared/`:
- SCSS source: `shiny/www/shared/sass/bslib/components/scss/`
- Compiled CSS: Theme-specific files
- JavaScript: `shiny/www/shared/bslib/components/components.min.js`

Run `make upgrade-html-deps` to update from upstream packages (bslib, shiny, sass, htmltools).

## Important Notes
- NEVER create unnecessary files (especially markdown/docs)
- ALWAYS prefer editing existing files over creating new ones
- Run `make docs` only at the end (it's slow)
- Test examples locally before committing
- Follow existing patterns in similar components
