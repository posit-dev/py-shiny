/*! bslib 0.9.0.9002 | (c) 2012-2026 RStudio, PBC. | License: MIT + file LICENSE */
var O=(n,r,e)=>{if(!r.has(n))throw TypeError("Cannot "+e)};var p=(n,r,e)=>(O(n,r,"read from private field"),e?e.call(n):r.get(n)),b=(n,r,e)=>{if(r.has(n))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(n):r.set(n,e)},U=(n,r,e,t)=>(O(n,r,"write to private field"),t?t.call(n,e):r.set(n,e),e);var m=(n,r,e)=>(O(n,r,"access private method"),e);var h=(n,r,e)=>new Promise((t,i)=>{var s=a=>{try{l(e.next(a))}catch(g){i(g)}},u=a=>{try{l(e.throw(a))}catch(g){i(g)}},l=a=>a.done?t(a.value):Promise.resolve(a.value).then(s,u);l((e=e.apply(n,r)).next())});function R(n,{type:r=null}={}){if(!window.Shiny)return;class e extends window.Shiny.InputBinding{constructor(){super()}find(i){return $(i).find(n)}getValue(i){return"getValue"in i?i.getValue():i.value}getType(i){return r}subscribe(i,s){i.onChangeCallback=s}unsubscribe(i){i.onChangeCallback=s=>{}}receiveMessage(i,s){i.receiveMessage(i,s)}}window.Shiny.inputBindings.register(new e,`${n}-Binding`)}var E=window.Shiny,te=E?E.InputBinding:class{};function P({headline:n="",message:r,status:e="warning"}){document.dispatchEvent(new CustomEvent("shiny:client-message",{detail:{headline:n,message:r,status:e}}))}function c(n,r){return Object.prototype.hasOwnProperty.call(n,r)&&n[r]!==void 0}function X(...n){return h(this,null,function*(){if(!E)throw new Error("This function must be called in a Shiny app.");return E.renderContentAsync?yield E.renderContentAsync.apply(null,n):yield E.renderContent.apply(null,n)})}function j(n,r){return h(this,null,function*(){if(typeof n!="undefined"){if(r.length!==1)throw new Error("labelNode must be of length 1");typeof n=="string"&&(n={html:n,deps:[]}),n.html===""?r.addClass("shiny-label-null"):(yield X(r,n),r.removeClass("shiny-label-null"))}})}var q="plain",z=2,J="github-light",Q="github-dark",V=400,S,w,y,f,L,M,_,C,x,o=class extends HTMLElement{constructor(){super(...arguments);this.onChangeCallback=()=>{}}get language(){var e;return(e=this.getAttribute("language"))!=null?e:q}set language(e){this.setAttribute("language",e)}get readonly(){return this.hasAttribute("readonly")&&this.getAttribute("readonly")!=="false"}set readonly(e){this.setAttribute("readonly",String(e))}get lineNumbers(){return this.getAttribute("line-numbers")!=="false"}set lineNumbers(e){this.setAttribute("line-numbers",String(e))}get wordWrap(){return this.getAttribute("word-wrap")==="true"}set wordWrap(e){this.setAttribute("word-wrap",String(e))}get tabSize(){let e=this.getAttribute("tab-size"),t=e?parseInt(e):z;return isNaN(t)?z:t}set tabSize(e){this.setAttribute("tab-size",String(e))}get insertSpaces(){return this.getAttribute("insert-spaces")!=="false"}set insertSpaces(e){this.setAttribute("insert-spaces",String(e))}get themeLight(){var e;return(e=this.getAttribute("theme-light"))!=null?e:J}set themeLight(e){this.setAttribute("theme-light",e)}get themeDark(){var e;return(e=this.getAttribute("theme-dark"))!=null?e:Q}set themeDark(e){this.setAttribute("theme-dark",e)}get value(){var e,t;return(t=(e=this.prismEditor)==null?void 0:e.value)!=null?t:""}set value(e){this.prismEditor&&this.prismEditor.setOptions({value:e})}getValue(){return this.value}connectedCallback(){if(this.prismEditor)return;this.initPromise=this._initializeEditor(),this.initPromise.then(()=>{this.onChangeCallback(!1)}).catch(t=>{P({headline:"Code Editor Initialization Error",message:"An error occurred while initializing the code editor. See console for details.",status:"error"}),console.error("Failed to initialize code editor:",t)});let e=()=>this.onChangeCallback(!0);this.addEventListener("bslibCodeEditorUpdate",e)}disconnectedCallback(){var e,t;(e=this.darkLightObserver)==null||e.disconnect(),this.darkLightObserver=void 0,(t=this.readonlyTooltipCleanup)==null||t.call(this),this.readonlyTooltipCleanup=void 0}attributeChangedCallback(e,t,i){var u,l;if(t===i||!this.prismEditor)return;let s=this.prismEditor;switch(e){case"language":i&&(this.languageChangePromise=this._handleLanguageChange(i));break;case"readonly":{let a=i==="true";s.setOptions({readOnly:a}),a&&!this.readonlyTooltipCleanup?this._setupReadOnlyTooltip(s):!a&&this.readonlyTooltipCleanup&&(this.readonlyTooltipCleanup(),this.readonlyTooltipCleanup=void 0);break}case"line-numbers":s.setOptions({lineNumbers:i!=="false"});break;case"word-wrap":s.setOptions({wordWrap:i==="true"});break;case"tab-size":{let a=i?parseInt(i):z;isNaN(a)||s.setOptions({tabSize:a});break}case"insert-spaces":s.setOptions({insertSpaces:i!=="false"});break;case"theme-light":i&&m(u=o,C,x).call(u,i);break;case"theme-dark":i&&m(l=o,C,x).call(l,i);break;default:break}}_initializeEditor(){return h(this,null,function*(){var D,B,N;let e=this.querySelector(".code-editor");if(!e){P({headline:"Code Editor Initialization Error",message:"Expected to find `.code-editor` inside `<bslib-code-editor>` container element.",status:"error"});return}let t=this.language,i=(D=this.getAttribute("value"))!=null?D:"";this.removeAttribute("value");let s=this.readonly,u=this.lineNumbers,l=this.wordWrap,a=this.tabSize,g=this.insertSpaces,v=m(B=o,f,L).call(B);yield m(N=o,M,_).call(N,t);let[{createEditor:T},{copyButton:F},{defaultCommands:W}]=yield Promise.all([import(`${v}/index.js`),import(`${v}/extensions/copyButton/index.js`),import(`${v}/extensions/commands.js`)]),k=T(e,{language:t,value:i,tabSize:a,insertSpaces:g,lineNumbers:u,wordWrap:l,readOnly:s},F(),W()),A=k.keyCommandMap.Enter;k.keyCommandMap.Enter=(I,G,K)=>I.metaKey||I.ctrlKey?(this.dispatchEvent(new CustomEvent("bslibCodeEditorUpdate")),e.classList.add("code-editor-submit-flash"),setTimeout(()=>{e.classList.remove("code-editor-submit-flash")},V),!0):A==null?void 0:A(I,G,K),this.prismEditor=k,this.darkLightObserver=this._setupThemeWatcher();let H=this.querySelector("textarea");return H&&H.addEventListener("blur",()=>{this.dispatchEvent(new CustomEvent("bslibCodeEditorUpdate"))}),s&&this._setupReadOnlyTooltip(k),k})}_setupThemeWatcher(){let e=()=>{var l;let u=document.documentElement.getAttribute("data-bs-theme")==="dark"?this.themeDark:this.themeLight;m(l=o,C,x).call(l,u)};e();let t=new MutationObserver(()=>e());return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),t}_handleLanguageChange(e){return h(this,null,function*(){var i;let t=this.prismEditor;if(t)try{yield m(i=o,M,_).call(i,e),t.setOptions({language:e}),t.update()}catch(s){P({headline:"Code Editor Language Load Error",message:`Failed to load language '${e}'. See console for details.`,status:"error"}),console.error(`Failed to load language '${e}':`,s)}})}_setupReadOnlyTooltip(e){return h(this,null,function*(){var t;try{let i=m(t=o,f,L).call(t),[{addTooltip:s},{cursorPosition:u}]=yield Promise.all([import(`${i}/tooltips.js`),import(`${i}/extensions/cursor.js`)]);u()(e);let l=document.createElement("div");l.className="code-editor-readonly-tooltip alert alert-danger",l.textContent="Cannot edit read-only editor.";let[a,g]=s(e,l,!1),v=()=>{this.classList.add("is-invalid"),a()},T=()=>{this.classList.remove("is-invalid"),g()};e.textarea.addEventListener("beforeinput",v,!0),e.on("selectionChange",T),e.textarea.addEventListener("click",T),this.readonlyTooltipCleanup=()=>{e.textarea.removeEventListener("beforeinput",v,!0),e.textarea.removeEventListener("click",T),g()}}catch(i){console.error("Failed to setup read-only tooltip:",i)}})}receiveMessage(e,t){return h(this,null,function*(){var i;if(this.initPromise&&(yield this.initPromise),!this.prismEditor){P({headline:"Code Editor could not update",message:"An update was ignored because the editor is not yet initialized.",status:"warning"});return}if(c(t,"value")&&(this.value=(i=t.value)!=null?i:""),c(t,"label")){let s=$(this).find("label");yield j(t.label,s)}c(t,"tab_size")&&t.tab_size!==void 0&&(this.tabSize=t.tab_size),c(t,"indentation")&&(this.insertSpaces=t.indentation==="space"),c(t,"read_only")&&t.read_only!==void 0&&(this.readonly=t.read_only),c(t,"line_numbers")&&t.line_numbers!==void 0&&(this.lineNumbers=t.line_numbers),c(t,"word_wrap")&&t.word_wrap!==void 0&&(this.wordWrap=t.word_wrap),c(t,"language")&&t.language&&(this.language=t.language,this.languageChangePromise&&(yield this.languageChangePromise,this.languageChangePromise=void 0)),c(t,"theme_light")&&t.theme_light&&(this.themeLight=t.theme_light),c(t,"theme_dark")&&t.theme_dark&&(this.themeDark=t.theme_dark),this.dispatchEvent(new CustomEvent("bslibCodeEditorUpdate"))})}},d=o;S=new WeakMap,w=new WeakMap,y=new WeakMap,f=new WeakSet,L=function(){if(p(o,y)!==null)return p(o,y);let e=document.querySelector('script[src*="prism-code-editor"][src$="index.js"]');if(!e)throw new Error("Could not find prism-code-editor script element. Ensure the prism-code-editor dependency is properly loaded.");let t=e.getAttribute("src");if(!t)throw new Error("prism-code-editor script element has no src attribute");let i=new URL(t,document.baseURI).href;return U(o,y,i.replace(/\/index\.js$/,"")),p(o,y)},M=new WeakSet,_=function(e){return h(this,null,function*(){var s;if(p(o,S).has(e)||["plain","plaintext","text","txt"].includes(e))return;let t=e;e==="html"&&(t="markup"),yield import(`${m(s=o,f,L).call(s)}/prism/languages/${t}.js`),p(o,S).add(e)})},C=new WeakSet,x=function(e){var u;if(p(o,w).has(e))return;let t=`code-editor-theme-${e}`;if(document.getElementById(t)){p(o,w).add(e);return}let i=m(u=o,f,L).call(u),s=document.createElement("link");s.id=t,s.rel="stylesheet",s.href=`${i}/themes/${e}.css`,s.addEventListener("load",()=>{p(o,w).add(e)}),s.addEventListener("error",()=>{console.error(`Failed to load code editor theme: ${e}`)}),document.head.appendChild(s)},b(d,f),b(d,M),b(d,C),d.tagName="bslib-code-editor",d.isShinyInput=!0,d.observedAttributes=["language","readonly","line-numbers","word-wrap","tab-size","insert-spaces","theme-light","theme-dark"],b(d,S,new Set),b(d,w,new Set),b(d,y,null);customElements.define(d.tagName,d);window.Shiny&&R(d.tagName);export{d as BslibCodeEditor};
//# sourceMappingURL=code-editor.min.js.map
