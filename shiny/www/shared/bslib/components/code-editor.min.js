/*! bslib 0.9.0.9002 | (c) 2012-2025 RStudio, PBC. | License: MIT + file LICENSE */
var x=(n,s,e)=>{if(!s.has(n))throw TypeError("Cannot "+e)};var c=(n,s,e)=>(x(n,s,"read from private field"),e?e.call(n):s.get(n)),p=(n,s,e)=>{if(s.has(n))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(n):s.set(n,e)},B=(n,s,e,t)=>(x(n,s,"write to private field"),t?t.call(n,e):s.set(n,e),e);var h=(n,s,e)=>(x(n,s,"access private method"),e);var g=(n,s,e)=>new Promise((t,i)=>{var r=d=>{try{u(e.next(d))}catch(w){i(w)}},l=d=>{try{u(e.throw(d))}catch(w){i(w)}},u=d=>d.done?t(d.value):Promise.resolve(d.value).then(r,l);u((e=e.apply(n,s)).next())});function N(n,{type:s=null}={}){if(!window.Shiny)return;class e extends window.Shiny.InputBinding{constructor(){super()}find(i){return $(i).find(n)}getValue(i){return"getValue"in i?i.getValue():i.value}getType(i){return s}subscribe(i,r){i.onChangeCallback=r}unsubscribe(i){i.onChangeCallback=r=>{}}receiveMessage(i,r){i.receiveMessage(i,r)}}window.Shiny.inputBindings.register(new e,`${n}-Binding`)}var y=window.Shiny,ee=y?y.InputBinding:class{};function C({headline:n="",message:s,status:e="warning"}){document.dispatchEvent(new CustomEvent("shiny:client-message",{detail:{headline:n,message:s,status:e}}))}function m(n,s){return Object.prototype.hasOwnProperty.call(n,s)&&n[s]!==void 0}function X(...n){return g(this,null,function*(){if(!y)throw new Error("This function must be called in a Shiny app.");return y.renderContentAsync?yield y.renderContentAsync.apply(null,n):yield y.renderContent.apply(null,n)})}function F(n,s){return g(this,null,function*(){if(typeof n!="undefined"){if(s.length!==1)throw new Error("labelNode must be of length 1");typeof n=="string"&&(n={html:n,deps:[]}),n.html===""?s.addClass("shiny-label-null"):(yield X(s,n),s.removeClass("shiny-label-null"))}})}var q="plain",z=2,J="github-light",Q="github-dark",V=400,k,f,b,E,P,T,O,v,L,o=class extends HTMLElement{constructor(){super(...arguments);this.onChangeCallback=()=>{}}get language(){var e;return(e=this.getAttribute("language"))!=null?e:q}set language(e){this.setAttribute("language",e)}get readonly(){return this.hasAttribute("readonly")&&this.getAttribute("readonly")!=="false"}set readonly(e){this.setAttribute("readonly",String(e))}get lineNumbers(){return this.getAttribute("line-numbers")!=="false"}set lineNumbers(e){this.setAttribute("line-numbers",String(e))}get wordWrap(){return this.getAttribute("word-wrap")==="true"}set wordWrap(e){this.setAttribute("word-wrap",String(e))}get tabSize(){let e=this.getAttribute("tab-size"),t=e?parseInt(e):z;return isNaN(t)?z:t}set tabSize(e){this.setAttribute("tab-size",String(e))}get insertSpaces(){return this.getAttribute("insert-spaces")!=="false"}set insertSpaces(e){this.setAttribute("insert-spaces",String(e))}get themeLight(){var e;return(e=this.getAttribute("theme-light"))!=null?e:J}set themeLight(e){this.setAttribute("theme-light",e)}get themeDark(){var e;return(e=this.getAttribute("theme-dark"))!=null?e:Q}set themeDark(e){this.setAttribute("theme-dark",e)}get value(){var e,t;return(t=(e=this.prismEditor)==null?void 0:e.value)!=null?t:""}set value(e){this.prismEditor&&this.prismEditor.setOptions({value:e})}getValue(){return this.value}connectedCallback(){if(this.prismEditor)return;this.initPromise=this._initializeEditor(),this.initPromise.then(()=>{this.onChangeCallback(!1)}).catch(t=>{C({headline:"Code Editor Initialization Error",message:"An error occurred while initializing the code editor. See console for details.",status:"error"}),console.error("Failed to initialize code editor:",t)});let e=()=>this.onChangeCallback(!0);this.addEventListener("codeEditorUpdate",e)}disconnectedCallback(){var e;(e=this.darkLightObserver)==null||e.disconnect(),this.darkLightObserver=void 0}attributeChangedCallback(e,t,i){var l,u;if(t===i||!this.prismEditor)return;let r=this.prismEditor;switch(e){case"language":i&&(this.languageChangePromise=this._handleLanguageChange(i));break;case"readonly":r.setOptions({readOnly:i==="true"});break;case"line-numbers":r.setOptions({lineNumbers:i!=="false"});break;case"word-wrap":r.setOptions({wordWrap:i==="true"});break;case"tab-size":{let d=i?parseInt(i):z;isNaN(d)||r.setOptions({tabSize:d});break}case"insert-spaces":r.setOptions({insertSpaces:i!=="false"});break;case"theme-light":i&&h(l=o,v,L).call(l,i);break;case"theme-dark":i&&h(u=o,v,L).call(u,i);break;default:break}}_initializeEditor(){return g(this,null,function*(){var H,D,U;let e=this.querySelector(".code-editor");if(!e){C({headline:"Code Editor Initialization Error",message:"Expected to find `.code-editor` inside `<bslib-code-editor>` container element.",status:"error"});return}let t=this.language,i=(H=this.getAttribute("value"))!=null?H:"";this.removeAttribute("value");let r=this.readonly,l=this.lineNumbers,u=this.wordWrap,d=this.tabSize,w=this.insertSpaces,M=h(D=o,E,P).call(D);yield h(U=o,T,O).call(U,t);let[{createEditor:R},{copyButton:W},{defaultCommands:j}]=yield Promise.all([import(`${M}/index.js`),import(`${M}/extensions/copyButton/index.js`),import(`${M}/extensions/commands.js`)]),S=R(e,{language:t,value:i,tabSize:d,insertSpaces:w,lineNumbers:l,wordWrap:u,readOnly:r},W(),j()),A=S.keyCommandMap.Enter;S.keyCommandMap.Enter=(I,G,K)=>I.metaKey||I.ctrlKey?(this.dispatchEvent(new CustomEvent("codeEditorUpdate")),e.classList.add("code-editor-submit-flash"),setTimeout(()=>{e.classList.remove("code-editor-submit-flash")},V),!0):A==null?void 0:A(I,G,K),this.prismEditor=S,this.darkLightObserver=this._setupThemeWatcher();let _=this.querySelector("textarea");return _&&_.addEventListener("blur",()=>{this.dispatchEvent(new CustomEvent("codeEditorUpdate"))}),S})}_setupThemeWatcher(){let e=()=>{var u;let l=document.documentElement.getAttribute("data-bs-theme")==="dark"?this.themeDark:this.themeLight;h(u=o,v,L).call(u,l)};e();let t=new MutationObserver(()=>e());return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),t}_handleLanguageChange(e){return g(this,null,function*(){var i;let t=this.prismEditor;if(t)try{yield h(i=o,T,O).call(i,e),t.setOptions({language:e}),t.update()}catch(r){C({headline:"Code Editor Language Load Error",message:`Failed to load language '${e}'. See console for details.`,status:"error"}),console.error(`Failed to load language '${e}':`,r)}})}receiveMessage(e,t){return g(this,null,function*(){var i;if(this.initPromise&&(yield this.initPromise),!this.prismEditor){C({headline:"Code Editor could not update",message:"An update was ignored because the editor is not yet initialized.",status:"warning"});return}if(m(t,"value")&&(this.value=(i=t.value)!=null?i:""),m(t,"label")){let r=$(this).find("label");yield F(t.label,r)}m(t,"tab_size")&&t.tab_size!==void 0&&(this.tabSize=t.tab_size),m(t,"indentation")&&(this.insertSpaces=t.indentation==="space"),m(t,"read_only")&&t.read_only!==void 0&&(this.readonly=t.read_only),m(t,"line_numbers")&&t.line_numbers!==void 0&&(this.lineNumbers=t.line_numbers),m(t,"word_wrap")&&t.word_wrap!==void 0&&(this.wordWrap=t.word_wrap),m(t,"language")&&t.language&&(this.language=t.language,this.languageChangePromise&&(yield this.languageChangePromise,this.languageChangePromise=void 0)),m(t,"theme_light")&&t.theme_light&&(this.themeLight=t.theme_light),m(t,"theme_dark")&&t.theme_dark&&(this.themeDark=t.theme_dark),this.dispatchEvent(new CustomEvent("codeEditorUpdate"))})}},a=o;k=new WeakMap,f=new WeakMap,b=new WeakMap,E=new WeakSet,P=function(){if(c(o,b)!==null)return c(o,b);let e=document.querySelector('script[src*="prism-code-editor"][src$="index.js"]');if(!e)throw new Error("Could not find prism-code-editor script element. Ensure the prism-code-editor dependency is properly loaded.");let t=e.getAttribute("src");if(!t)throw new Error("prism-code-editor script element has no src attribute");let i=new URL(t,document.baseURI).href;return B(o,b,i.replace(/\/index\.js$/,"")),c(o,b)},T=new WeakSet,O=function(e){return g(this,null,function*(){var r;if(c(o,k).has(e)||["plain","plaintext","text","txt"].includes(e))return;let t=e;e==="html"&&(t="markup"),yield import(`${h(r=o,E,P).call(r)}/prism/languages/${t}.js`),c(o,k).add(e)})},v=new WeakSet,L=function(e){var l;if(c(o,f).has(e))return;let t=`code-editor-theme-${e}`;if(document.getElementById(t)){c(o,f).add(e);return}let i=h(l=o,E,P).call(l),r=document.createElement("link");r.id=t,r.rel="stylesheet",r.href=`${i}/themes/${e}.css`,r.addEventListener("load",()=>{c(o,f).add(e)}),r.addEventListener("error",()=>{console.error(`Failed to load code editor theme: ${e}`)}),document.head.appendChild(r)},p(a,E),p(a,T),p(a,v),a.tagName="bslib-code-editor",a.isShinyInput=!0,a.observedAttributes=["language","readonly","line-numbers","word-wrap","tab-size","insert-spaces","theme-light","theme-dark"],p(a,k,new Set),p(a,f,new Set),p(a,b,null);customElements.define(a.tagName,a);window.Shiny&&N(a.tagName);export{a as BslibCodeEditor};
//# sourceMappingURL=code-editor.min.js.map
